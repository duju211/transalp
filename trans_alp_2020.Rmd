---
title: "Getting Over It"
description: |
  Visualising my Transalp bike ride
author:
  - name: Julian During
date: "`r Sys.Date()`"
repository_url: https://github.com/duju211/transalp
creative_commons: CC BY
---

This summer I crossed the alps with my road bike. I've recorded the whole ride
and as a nice memory, I would like to visualise this ride. 

A short time ago I've discovered the awesome R package `drake`.
The use of this package
transformed the way I do my analysis and it helps me to make my post more 
reproducible. The following
[blog post](https://milesmcbain.xyz/the-drake-post/)
describes the underlying workflow, after which I've developed the
underlying package `transalp` for this post.

# Data

Load the other necessary libraries:

```{r message=FALSE, warning=FALSE, include=FALSE}
source("libraries.R")
```

```{r, code=read_lines("libraries.R"), eval=FALSE}
```


Load raw data from `rds` file `r tar_read(act_meas_path)`.

```{r, code=read_lines("R/read_data.R")}
```

```{r, echo=FALSE}
tar_read(df_act_meas)
```

# Preprocessing

Look at the first function:

```{r pre_process_meas, code=read_lines("R/pre_process_meas.R")}
```

The function does some basic preprocessing on the included activities:

* Turn activity date into character (for easier plotting)
* Normalize altitude and distance

Nest the data frame by `id` and `act_date_chr`. Create a new `sf` column with
the geospatial information of the activities:

```{r convert_to_sf, code=read_lines("R/convert_to_sf.R")}
```

```{r, echo=FALSE}
tar_read(sf_act_meas)
```

Extract the start point of every tour except for the last one. Extract the end
point for this tour.

```{r extract_poi, code=read_lines("R/extract_poi.R")}
```

# Visualisation

## Altitude

Visualise the altitude data:

```{r vis_altitude, code=read_lines("R/vis_altitude.R")}
```

```{r gg_altitude, echo=FALSE}
tar_read(gg_altitude)
```

## Spatial Data

Determine the map data for all the activities. Use the `ggmap::get_stamenmap`
function to download the data. The bounding box is calculated from the
`sf_act_meas` object.

```{r get_alpen_map, code=read_lines("R/get_alpen_map.R")}
```

```{r gg_alpen, echo=FALSE}
ggmap::ggmap(tar_read(gg_alpen))
```


Plot the activity and the point of interest data onto the map. Use the 
`ggrepel` package to plot the labels of the points of interest. This avoids
too much overplotting.

```{r vis_ride, code=read_lines("R/vis_ride.R")}
```

```{r gg_rides, echo=FALSE}
tar_read(gg_rides)
```

## Combine Visualisations

Combine everything into one big plot using the `patchwork` package:

```{r transalp_plot_final, code=read_lines("R/vis_transalp.R")}
```

```{r}
knitr::include_graphics(tar_read(png_gg_transalp))
```

